<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>이름 마스킹 & 전화번호 하이픈 변환</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    th { background-color: #eee; }
  </style>
</head>
<body>
  <h2>엑셀 업로드 → 이름 가운데 * 마스킹 + 전화번호 변환</h2>
  <input type="file" id="fileInput" accept=".xlsx" />
  <label for="phoneFormat">전화번호 형식:</label>
  <select id="phoneFormat">
    <option value="hyphen">하이픈 유지 (010-1234-5678)</option>
    <option value="plain">하이픈 제거 (01012345678)</option>
    <option value="last4">뒤 4자리만 (5678)</option>
  </select>

  <div id="output"></div>

  <script>
    function maskName(name) {
      if (typeof name !== 'string') return '';
      if (name.length === 3) {
        return name[0] + '*' + name[2];
      }
      return name;
    }

    function formatPhoneNumber(phone, mode) {
      const digits = phone.toString().replace(/\D/g, '');
      if (digits.length < 10) return '';
      const part1 = digits.slice(0, 3);
      const part2 = digits.slice(3, 7);
      const part3 = digits.slice(7, 11);

      if (mode === 'hyphen') {
        return `${part1}-${part2}-${part3}`;
      } else if (mode === 'plain') {
        return `${part1}${part2}${part3}`;
      } else if (mode === 'last4') {
        return part3;
      } else {
        return phone;
      }
    }

    document.getElementById('fileInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(event) {
        const data = new Uint8Array(event.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheetName = workbook.SheetNames[0];
        const sheet = workbook.Sheets[sheetName];
        const json = XLSX.utils.sheet_to_json(sheet);

        const format = document.getElementById('phoneFormat').value;
        let html = '<table><tr><th>이름 (마스킹)</th><th>전화번호</th></tr>';

        json.forEach(row => {
          const maskedName = maskName(row['이름']);
          const formattedPhone = formatPhoneNumber(row['전화번호'], format);
          html += `<tr><td>${maskedName}</td><td>${formattedPhone}</td></tr>`;
        });

        html += '</table>';
        document.getElementById('output').innerHTML = html;
      };

      reader.readAsArrayBuffer(file);
    });
  </script>
</body>
</html>
